# Project G: Handwriting (& Signatures)
```{r handwritingsetup, echo=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE)
```

The handwriting project has four major focuses:

  1. data collection
  2. computational tools
  3. statistical analysis
      a. glyph clustering
      b. closed set modeling for writer identification
  4. communication of results

## Data Collection
We are conducting a large data collection study to gather handwriting samples from a variety of participants across the world (most in the Midwest). Each participant provides handwriting samples at three sessions. Session packets are prepared, mailed to participants, completed, and mailed back. Once recieved, we scan all surveys and writing samples. Scans are loaded, cropped, and saved using a Shiny app. The app also facilitates survey data entry, saving that participant data to lines in an excel spreadsheet.

As of September 2019, Marc and Anyesha are the primary contacts for the study. Phase 2 recruiting is underway.

<strong>The first 90 complete writers were published:</strong>
> Crawford, Amy; Ray, Anyesha; Carriquiry, Alicia; Kruse, James; Peterson, Marc (2019): CSAFE Handwriting Database. Iowa State University. Dataset. https://doi.org/10.25380/iastate.10062203.

Anyesha and I worked on a variety of <strong>data quality checks and batch processing</strong> prior to publication. Scanner cuts a portion of the left side of the documents off sporadically. Survey date checks. Batch removal of header.
```{r, fig.cap="Batch process samples: rotate 0.05 degrees, turn black line pixels white, crop 450 pixels from top (under QR code), rename.", out.width="90%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/promptimage.png"))
```

We hit a bump with the ISU Office for Responsible Research (ORR). </summary> They had concerns with the demographic variables we collected on the surveys and wanted to publish. We "negotiated'' and settled on the following survey information.

```{r, fig.cap="", out.width="110%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/surveydata_header.png"))
```
<br>

<details>
<summary><span class="new">A data article has been submitted to [Data in Brief](https://www.journals.elsevier.com/data-in-brief).</span>  <i>"I think this manuscript should probably be accepted providing some small revisions are made. Overall it is a very high quality data article."</i>   
 - Sample selection method details.  
 - Link to Shiny application for scan and survey processing.  </summary>
<br>
```{r, fig.cap="", out.width="90%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/datainbrief_header.png"))
```
</details>   


## Computational Tools
`handwriter` is a developmental R package hosted at https://github.com/CSAFE-ISU/handwriter. It is our major computational tool for the project. The package takes in scanned handwritten documents and the following are performed. 

1. <strong> Binarize.</strong> Turn the image to pure black and white.
2. <strong> Skeletonize. </strong> Reduce writing to a 1 pixel wide skeleton.
3. <strong> Break. </strong> Connected writing is decomposed into small manageable pieces called <strong> glyphs </strong>. Glyphs are graphical structures with nodes and edges that often, but not always, correspond to Roman letters, and are the smallest unit of observation we consider for statistcal modelling.
4. <strong> Measure. </strong> A variety of measurements are taken on each glyph.

```{r, fig.cap="Connected text processed by `handwriter`. The grey background is the original pen stroke. Colored lines represent the single pixel skeleton with color changes marking glyph decomposition. Red dots mark endpoints and intersections of each glyph.", out.width="50%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/handwriter_csafe.png"))
```


For an input document, functions in the package give back a list of glyphs with path and node location information, adjacency grouping assignment, slope (pictured below), and centroid locations, among other things.

```{r, fig.cap="A visual of the ''slope'' calculation for two glyphs.", out.width="90%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/handwriter_slopecalc.png"))
```

<br>

*Compactness measuremnt*, by James.


```{r, fig.cap="A visual of the ''compactness'' calculation for glyphs.", out.width="90%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/compactness.png"))
```

We are currently working to incorporate the cluster grouping assignments into the package. This will be complete pending creation of a template.

## Statistical Analysis
### Clustering

 
Paper submitted in September 2019.

```{r, fig.cap="", out.width="70%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/clusterpaper_header.png"))
```

---

Rather than impose rigid grouping rules (the previously used ''adjacency grouping'') we consider a more robust, dynamic $K-$means type clustering method that is focused on major glyph structural components.  
  
Clustering algorithms require:

  - <strong> A distance measure.</strong> For us, a way to measure the discrepancy between glyphs.
  - <strong> A measure of center.</strong> A glyph-like structure that is the exemplar representation of a group of glyphs.

#### Glyph Distance Measure {-}
We begin by defining edge to edge distances. Edge to edge distances are subsequently combined for an overall glyph to glyph distance.

<strong>Edge to edge distances:</strong>

Consider the following single edge glyphs, $e_1$ and $e_2$. Make $3$ edits to $e_1$ to match $e_2$. The combined magnitude of each edit make the edge distance.
```{r, fig.cap="Two edges that are also glyphs, $e_1$ and $e_2$.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/DistMeasurePlot1.png"))
```

1. <strong> Shift</strong>. Anchor to the nearest endpoint by shifting.
```{r, fig.cap="Shift = 1.4.", out.width="25%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/DistMeasurePlot2.png"))
```


2. <strong> Stretch</strong>. Make the endpoints the same distance apart.
```{r, fig.cap="Stretch = 9.9.", out.width="25%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/DistMeasurePlot3.png"))
```


3. <strong> Shape</strong>. Bend and twist the edge using $7$ shape points. Shape points are ''matched'' and the distance between them is averaged to obtain the shape contribution to the distance measure.
```{r, fig.cap="Shape Components.", out.width="25%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/DistMeasurePlot4.png"))
```

```{r, fig.cap="Shape = 8.4.", out.width="100%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/DistMeasurePlot5.png"))
```

Combine the three measurements for a final edge to edge distance. D$(e_1, e_2) = 1.4 + 9.9 + 8.4 = 19.7$.

For multi-edge glyphs get pairwise edge distances. Minimize total glyph distance using linear programming to match edges (sudoku). Down-weight edge distance contributions based on edge lengths. There are nuances associated with all of this. We must handle glyphs with differing number of edges, and consider the direction in which edges are compared (endpoint labels are arbitrary). All of this is addressed in detail in the paper.


#### Measure of glyph centers {-}
Take the weighted average of endpoints, $7$ shape points, and edge length.
```{r, fig.cap="Weighted mean between two glyphs. p = weight on blue.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/Meanplot1.png"))
```


The mean of a set can be iteratively calculated by properly weighting each newly introduced glyph. For stability, the $K-$means algorithm finds the glyph nearest the mean and uses that \emph{exemplar} as measure of cluster center.


#### $K-$means Algorithm for Glyphs {-}

Implement a standard $K-$means ^[Forgy, E. (1965). Cluster Analysis of Multivariate Data: Efficiency vs. Interpretability of Classifications. Biometrics, 21:768–780.]   ^[Lloyd, S. (1982). Least Squares Quantization in PCM. IEEE Trans. on Information Theory, 28(2):129–137.] with handling of outlier observations. ^[Gan, G. and Ng, M. K.-P. (2017). K-means  clustering with outlier removal. Pattern Recog. Letters, 90:8–14.]

Begin with fixed $K$ and a set of exemplars. Iterate between the following steps until cluster assignments do not change:

1. Assign each glyph to the exemplar it is nearest to, with respect to the glyph distance measure.  
2. Calculate each cluster mean as defined. Find the exemplar nearest the cluster mean and use it as the new cluster center.

```{r, fig.cap="One of $K=40$ Clusters. Exemplar & cluster members (left). Cluster mean (right).", out.width="40%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/Cluster40.png"))
```


Use one document from each training writer to cluster and obtain a template. Make cluster assignments for the remaining documents by finding the template exemplar each glyph is nearest to. Below is an example of data that arises from the clustering method.


```{r, fig.cap="Data arising from the cluster grouping method. Cluster #'s ordered by most to least populated.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/Clusterdata.png"))
```


#### Outliers
During clustering, outliers are considered glyphs that are at least $T_o$ distance units from cluster exemplars. The algorithm sets a ceiling $n_o$ on the allowable number of outliers. Initially, we were going to ignore the outliers, but now they are considered the $K+1$th cluster and contribute information about writer.

```{r, fig.cap="Cluster of outliers.", out.width="80%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/HW_Outliers.png"))
```


#### <span class="new"> CVL + CSAFE Template Development </span>
<span class="new">Template development on 23 CVL documents and 77 CSAFE documents, each from a unique writer. </span>

1. Starting values.
2. Changes to the distance measurement to emphasize shape, and focus less on character size.
    - $\frac{1}{2}\times$ **Stretch** (straight line distance component, ~ size)
    - 1 $\times$ **Shift** (nearest endpoint)
    - 2 $\times$ **Shape**
    - (ghost edge comparisons)$^2$
3. A sample template is picture below. 
    - 27 CVL documents (6 unique), 73 CSAFE documents (2 unique)
    - Currently working on 20+ algorithm runs with a variety of starting values to select final template.

```{r, fig.cap="Cluster Members and Exemplars.", out.width="80%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/d100_sm0_seed65_exemplars.png"))
```

```{r, fig.cap="Cluster Means.", out.width="78%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/d100_sm0_seed65_means.png"))
```


### Closed set modeling


#### Model #1, Straw Man {-}
Let,  


  - $\boldsymbol{Y}_{w(d)} = \{Y_{w(d),1}, \dots, Y_{w(d),K}\}$ be the number of glyphs assigned to each cluster for document within writer, $w(d),$ and
  - $\boldsymbol{\pi}_w = \{\pi_{w,1}, \dots, \pi_{w,K} \}$ be the rate at which a writer emits glyphs to each cluster.
  - Here, $K = 41$, $d = 1,2,...,5$, $w = 1,...,27$.

Then a hierarchical model for the data is
$$\begin{array}{rl}
     \mathbf{Y}_{w(d)}\: &\stackrel{ind}{\sim} \:Multinomial(\boldsymbol\pi_{w}), \\
\boldsymbol{\pi}_w \:&\stackrel{ind}{\sim}\: Dirichlet(\boldsymbol{\alpha}),\\
\alpha_{1}, \dots, \alpha_{K}\: &\stackrel{iid}{\sim}\: Gamma(2, \:0.25).  \label{model_line3}
\end{array}$$

<strong> Posterior Predictive Analysis </strong>  


For a holdout document of unknown source, $w^*$,  

  - Extract glyphs with \emph{handwriter} and assign groups,
      - $\boldsymbol{Y}^*_{w^*}=\{Y_{w^*,1}, ... Y_{w^*,K}\}$
  - Assess the posterior probability of writership under each known writer $\boldsymbol\pi_{w}$ vectors.
      - i.e. $p(w^* = w^\prime|\boldsymbol{Y^*}, \boldsymbol{Y})$ for each writer $w^\prime$ in the training data.


The posterior probability that the questioned document  $\boldsymbol{Y}^*_{w^*}$ belongs to writer $w^\prime$ with respect to the closed set is,
$$\begin{array}{rl}
    p(w^* = w^\prime|\boldsymbol{Y}^*, \boldsymbol{Y}) 
     & \propto p(\boldsymbol{Y}^*| w^* = w^\prime, \boldsymbol{Y}) p(w^*=w^\prime | \boldsymbol{Y})\nonumber\\
     & \propto p(\boldsymbol{Y}^*| w^* = w^\prime, \boldsymbol{Y})   \nonumber\\
    & = \int p(\boldsymbol{Y}^*|   \boldsymbol{\pi}_{w^\prime}) p(\boldsymbol{\pi}_{w^\prime}| \boldsymbol{Y}) d \boldsymbol{\pi}_{w^\prime}\nonumber\\ 
    & \approx \frac{1}{M} \sum_{m=1}^M p(\boldsymbol{Y}^*|   \boldsymbol{\pi}^{(m)}_{w^\prime}) , \mbox{ where }  \boldsymbol{\pi}^{(m)}_{w^\prime} \sim p(\boldsymbol{\pi}_{w^\prime}|\boldsymbol{Y})  \nonumber 
\end{array}$$  


for MCMC iterations $m = 1, \dots, M$. Then, for a given iteration $m$,

$$
p(\boldsymbol{Y}^*|   \boldsymbol{\pi}^{(m)}_{w^\prime}) =    p_{w^\prime}^{(m)} =  \frac{Mult(\boldsymbol{Y}^*; \boldsymbol{\pi}_{w^\prime}^{(m)})}{\sum_{w_i = 1}^{27}Mult(\boldsymbol{Y}^*; \boldsymbol{\pi}_{w_i}^{(m)}) }. \nonumber
$$
Calculate the quantitity for each known writer $w^\prime = w_1, \dots, w_{27}$ in training set to get
$$
\boldsymbol{p}^{(m)} = \{p_{w_1}^{(m)}, ..., p_{w_{27}}^{(m)}\},
$$
and compute summaries over the MCMC draws,
$$
\boldsymbol{\bar{p}} = \{\bar{p}_{w_1},...,\bar{p}_{w_{27}}\}.
$$


<strong> Results </strong>  


If we use a single holdout document for each writer (doc 4). The $\boldsymbol{\bar{p}}$ vector as given above is shown graphically for each holdout document (the rows).

```{r, fig.cap="Posterior predictive results. Rows are evaluated independently and the probability in each row sums to one. Log Loss = 0.2013", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/CVL_w27_h4_cluster40_basemodel_grid.png"))
```

<br>

We can use a cross validation routine to estimate error. For each writer, shuffle the order of their body of documents. For the first fold we holdout the first document for testing, for the second fold we hold out the second document for testing, etc.. This yields 6 results analogous to that of the figure above.


```{r, fig.cap="Posterior predictive results for each fold of the CV routine outlined above. Log Loss is clearly not a great summary of performance.", out.width="100%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/CVL_w27_CVfoldall_cluster40_basemodel_grid.png"))
```

<br>

<strong> Evaluating Over-/Under-dispersion (Writer Variability Index) </strong>  
With a count data model it is important to investigate the presence of over- and under-dispersion. An index of intra-writer variability with respect to a model.  
  
  - Multivariate Generalized Dispersion Index (GDI) of Kokonendji and Puig^[Kokonendji, C. C. and Puig, P. (2018). Fisher Dispersion Index for Multivariate Count Distributions. Journal of Multivariate Analysis, v165 p180-193.].
  - Relative Dispersion Index (RDI) = $\frac{\mbox{writer data GDI}}{\mbox{model simulated GDI}}.$
  - High RDI $\implies$ data over-dispersion and high sample to sample variability.


```{r, fig.cap="RDIs for the 27 CVL writers under Model #1.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/RDI_table.png"))
```


High RDI $\implies$ data over-dispersion \& high sample to sample variability (in the sense of glyph cluster membership rates).

```{r, fig.cap="Handwriting Samples from Writer #12. Notice the repeated patterns in letters 'a', 'e', 'f', 'g', 'h', 't', etc. across samples.", out.width="70%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/writer12samples.png"))
```


```{r, fig.cap="Handwriting Samples from Writer #23. Note the red 'h's, green 'll's, purple terminal 'y's, and blue 'loo's", out.width="80%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/writer23samples.png"))
```



#### Model #2, Mixture{-}
There seem to be greatly varying shapes in the relative frequency of cluster fill. We think maybe a more flexible Dirichlet distribution is warranted.
```{r, fig.cap="Average relative frequency of cluster fill for the 8 most common clusters. Notice writers 12/21 and 6/17/18.", out.width="80%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/bucketfillshapes.png"))
```

Add flexibility to the original model by including a mixture component in the Dirichlet parameter space.

$$\begin{array}{rl}
     \mathbf{Y}_{w(d)} | \boldsymbol\pi_{w}, w\: &\stackrel{ind}{\sim} \:Multinomial(\boldsymbol\pi_{w}), \\
\boldsymbol{\pi}_w|\boldsymbol{\alpha},\boldsymbol{\beta}, \rho_w  \:&\stackrel{ind}{\sim}\:Dirichlet(\rho_w \: \boldsymbol{\alpha}+ (1-\rho_w)  \: \boldsymbol{\beta}), \\
\alpha_{k}, \: \beta_{k} \: &\stackrel{iid}{\sim}\: Gamma(2, \: 0.25) \:\: \mbox{ for } k > 3,  \\
\rho_w\: & \stackrel{iid}{\sim}\: Beta(1,1)
\end{array}$$


<strong> Label Switchin Issues. </strong>  
The model is non-identifiabile. We need to either place constraints on the parameter space to exclude the possibility of a second mode apriori, or estimate the posterior in both modes and post-process for label reassignment after.
This has been resolved (?) by placing constraints on the first three elements of $\alpha$ and $\beta$ with moderately informative priors.

  - $\mathbf{\alpha_1 < \beta_1}$, $\quad$  $\alpha_1 \sim Gamma(2, 0.25) \:\: \& \:\: \beta_1 \sim Gamma(4, 0.25)$  
        
  - $\mathbf{\alpha_2 > \beta_2}$  , $\quad$  $\alpha_2 \sim Gamma(4, 0.25) \:\: \& \:\: \beta_2 \sim Gamma(1, 0.25)$  
        
  - $\mathbf{\alpha_3 > \beta_3}$ , $\quad$  $\alpha_3 \sim Gamma(4, 0.25) \:\: \& \:\: \beta_3 \sim Gamma(1, 0.25)$   
        
```{r, echo = FALSE, message = FALSE, warning=FALSE, fig.height=2.5, fig.width = 6.5, fig.align='center'}
library(tidyverse)
x = seq(0, 30, length.out = 1000)
df = data.frame(x = x, 
                gam4 = dgamma(x, shape = 4, rate = 0.25),
                gam2 = dgamma(x, shape = 2, rate = 0.25),
                gam1 = dgamma(x, shape = 1, rate = 0.25))

df %>% gather(key = "GammaDist", value = "value", -x) %>%
  ggplot() + geom_line(aes(x = x, y = value, color = GammaDist)) + theme_bw() +  scale_color_discrete(name = "Distribution", labels = c("Gamma(1, 0.25)", "Gamma(2, 0.25)", "Gamma(4, 0.25)"))
```

<strong> Results </strong>    

The mixing component gives insights into writing style.
```{r, fig.cap="Average \rho_w value for each writer.", out.width="70%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/mixprior_rhosamps2.png"))
```  

 
```{r, fig.cap="Writing samples in a variety of styles based on the mixing parameter. From top to bottom, writer #'s 21, 4, 29, 20, 18.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/writingsamples_style.png"))
```

Evaluate the posterior probability of writership for each of the holdout documents.
```{r, fig.cap="Posterior predictive results. Rows are evaluated independently and the probability in each row sums to one. Log Loss = 0.2078", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/CVL_w27_h4_cluster40_mixparam_grid.png"))
```


#### <span class="new"> Model #2, CVL + CSAFE Template </span>
The following analysis was done for the first 20 CSAFE writers.

- Training docs: s01_pLND_r01, s01_pLND_r03, s01_pWOZ_r02, s01_pPHR_r03  
- Testing doc: s01_pLND_r02

```{r, fig.cap="Average relative frequency of cluster fill for the 8 most common clusters.", out.width="90%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/csafe20_relfreqbyrho_template65_first8clusters.png"))
```

Posterior probability results.
```{r, fig.cap="Posterior predictive results. Rows are evaluated independently and the probability in each row sums to one.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/csafe20_postprobs_template65.png"))
```

Not surprising. Working on:

- More writers (need to go through handwriter)
- Testing on the phrase prompt
- Including not yet seen CVL writers in analysis.



#### Model #3, Normal Slopes. Work in progress. {-}  

Adding slope measurements into the model.  


Let,

  - $\boldsymbol{Y}_{w(d)} = \{Y_{w(d),1}, \dots, Y_{w(d),K}\}$ be the number of glyphs assigned to each group for document within writer, $w(d),$
  - $\boldsymbol{\bar{S}}_{w(d)} = \{\bar{S}_{w(d),1}, \dots, \bar{S}_{w(d),K}\}$, be the average slope in each group for document $w(d)$
      - $G_{w(d),j}$ be the $j^{th}$ glyph in document $w(d)$,
      - $g_{w(d), j} = 1, \dots, 41$ be the available cluster assignments for the $j^{th}$ glyph in the document,
      - $S_{w(d),j}$ be the slope of the $j^{th}$ glyph in the document.

  - Here, $K = 41$, $d = 1,2,...,5$, $w = 1,...,27$, $j= 1, \dots,\mathrm{J}_{w(d)}.$


$$
\bar{S}_{w(d),k}= \frac{1}{Y_{w(d),k}} \sum_{j \ni  \mathrm{I}[g_j = k]}S_{w(d),j} \quad \& \quad Y_{w(d),k} = \sum_{j = 1}^{\mathrm{J}_{w(d)}} \mathrm{I}[g_j = k]
$$


Then a hierarchical model for the data is  


$$\begin{array}{rl}
     \mathbf{Y}_{w(d)} | \boldsymbol\pi_{w}, w\: &\stackrel{ind}{\sim} \:Multinomial(\boldsymbol\pi_{w}), \\
\boldsymbol{\pi}_w|\boldsymbol{\alpha} \:&\stackrel{ind}{\sim}\:Dirichlet(\boldsymbol{\alpha}), \\
\alpha_k\: &\stackrel{iid}{\sim}\: Gamma(a = 2, \: b= 0.25),  \\
\bar{S}_{w(d),k} | Y_{w(d),k}, w, \mu_{w, k}, \sigma^2_{k}  \: & \stackrel{iid}{\sim}\: N \left(\mu_{w, k}, \frac{\sigma^2_{k}}{Y_{w(d),k}}\right) \\
\mu_{w, k} | \mu_{k} \: & \stackrel{iid}{\sim}\:  N(\mu_{k}, 3) \\
\mu_{k} \: & \stackrel{iid}{\sim}\:  N(0, 3) \\
1/\sigma^2_{k}\: & \stackrel{iid}{\sim}\:  Gamma(0.5, 0.1)
\end{array}$$


Consider a new document with cluster fill counts $\boldsymbol{Y}^*$ and average slope measurements $\boldsymbol{\bar{S}}^*$ from unknown writer $w^*$.  

<strong> Posterior Predictive Analysis </strong>  


Posterior probability that the questioned document belongs to writer $w^\prime$ with respect to the closed set is:
\begin{array}{rl}
    &p(w^* = w^\prime|\boldsymbol{\bar{S}}^* \boldsymbol{Y}^*, \dots) \nonumber \\
      &\qquad \qquad \propto \left[ \: \prod_{k=1}^{K}p(\bar{S}^*_k | Y^*_{k}, w^* = w^\prime, \dots) \right]  p(\boldsymbol{Y}^* | w^* = w^\prime, \dots ) \nonumber \\
      &\qquad \qquad \approx \frac{1}{M} \sum_{m=1}^{M} \left[ \: \prod_{k=1}^{K}N \left(\mu_{w, k}^{(m)}, \frac{\sigma^{2(m)}_{k}}{Y_{w(d),k}}\right) \right]  Mult(\boldsymbol{Y}^*; \boldsymbol{\pi}_{w^\prime}^{(m)}) \nonumber
\end{array}
for MCMC samples $m = 1, \dots, M$.

<strong> Results </strong>    

Evaluate the posterior probability of writership for each of the holdout documents.
```{r, fig.cap="Posterior predictive results. Rows are evaluated independently and the probability in each row sums to one. Log Loss = 0.0883.", out.width="60%", fig.keep="hold", fig.align='center'}
include_graphics(c( "images/handwriting/amy/CVL_w27_h4_cluster40_normslopemean_grid.png"))
```


#### Modeling Summary {-}
```{r}
df = data.frame(Model = c("#1", "#1", "#2", "#3"), Data = c("Adjacency Grouping (not presented)", "Cluster Grouping", "Cluster Grouping", "Cluster Grouping & Glyph Slopes"), LogLoss = c(0.5413, 0.2013, 0.2078, 0.0883))

kable(df)
```

## Communication of Results  
Presenting author is in bold.

### Papers
- <strong>"A Clustering Method for Graphical Handwriting Components and Statistical Writership Analysis"</strong>
    - Authors: Nick Berry and Amy Crawford
    - Submitted to The Annals of Applied Statistics in September 2019.
    
- <strong>"A Database of Handwriting Samples for Applications in Forensic Statistics"</strong>
    - Authors: Anyesha Rey, Amy Crawford, and Alicia Carriquiry
    - Submitted to Data in Brief in October 2019.
    
- <strong>"Bayesian Hierarchical Modeling for Forensic Handwriting Analysis"</strong>
    - Authors: Amy Crawford, Alicia Carriquiry, and Danica Ommen
    - In preparation for submission to PNAS.

### Talks
- <strong>"Statistical Analysis of Handwriting for Writer Identification"</strong>
    - August 2019
    - Authors: <strong>Amy Crawford</strong>, Nick Berry, Alicia Carriquiry, Danica Ommen
    - American Society of Questioned Document Examiners (ASQDE) Annual Meeting in Cary, NC.
 
- <strong>"A Bayesian Hierarchical Mixture Model with Applications in Forensic Handwriting Analysis"</strong>
    - July 2019
    - Authors: <strong>Amy Crawford</strong>, Nick Berry, Alicia Carriquiry Danica Ommen
    - Joint Statistical Meetings (JSM) in Denver, CO.
    
- <strong>"Forensic Analysis of Handwriting"</strong>
    - July 2019
    - Authors: <strong>Alicia Carriquiry</strong>, Amy Crawford, Nick Berry, Danica Ommen
    - VI Latin American Meeting on Bayesian Statistics (VI COBAL), Lima, Peru.
    
- <strong>"Exploratory Analysis of Handwriting Features: Investigating Numeric Measurements of Writing"</strong>
    - February 2019
    - Authors: <strong>Amy Crawford</strong>, Nick Berry, Alicia Carriquiry, Danica Ommen
    - American Academy of Forensic Sciences (AAFS) Annual Meeting in Baltimore, MD.
    
- <strong>"Toward a Statistical and Algorithmic Approach to Forensic Handwriting Comparison"</strong>
    - August 2018
    - Authors: <strong>Amy Crawford</strong> and Alicia Carriquiry
    - American Society of Questioned Document Examiners (ASQDE) Annual Meeting in Park City, UT.
    
- <strong>"A Bayesian Approach to Forensic Handwriting Evidence"</strong>
    - July 2018
        - Authors: <strong>Amy Crawford</strong> and Alicia Carriquiry
    - Joint Statistical Meetings (JSM) in Vancouver, BC, Canada.
    
- <strong>"Bringing Statistical Foundations to Forensic Handwriting Analysis"</strong>
    - May 2018
    - Authors: <strong>Amy Crawford</strong> and Alicia Carriquiry
    - American Bar Association, 9th Annual Prescription for Criminal Justice Forensics Program in New York, NY.

### Posters
- <strong>"A Bayesian Hierarchical Model for Forensic Writer Identification"</strong>
    - September 2019
    - Authors: <strong>Amy Crawford</strong>, Alicia Carriquiry, Danica Ommen
    - 10th International Workshop on Statistics and Simulation in Salzburg, Austria
    - <i>1st Springer Poster Award</i>
    ![Poster given at the 10th International Workshop on Simulation and Statistics](images/handwriting/amy/Crawford_SIMSTAT_2019.png)
    
- <strong>"Statistical Analysis of Handwriting"</strong>
    - May 2019
    - Authors: <strong>Amy Crawford</strong> and Nick Berry
    - CSAFE Annual All-Hands Meeting in Ames, IA

- <strong>"Statistical Analysis of Letter Importance for Document Examination"</strong>
    - February 2018
    - Authors: <strong>Amy Crawford</strong> and Alicia Carriquiry
    - American Academy of Forensic Sciences in Seattle, WA
    - <i>YFSF Best Poster Award</i>
    
- <strong>(Presented AAFS 2018 Poster for a Second Time)</strong>
    - May 2018
    - Authors: <strong>Amy Crawford</strong> and Alicia Carriquiry
    - CSAFE Annual All-Hands Meeting in Ames, IA
    

## People involved

### Faculty

- Alicia Carriquiry
- Hal Stern (UCI, Project G PI)
- Danica Ommen

### Graduate Students

- Amy Crawford

### Undergraduates

- Anyesha Ray (data collection)
- James Taylor (feature extraction)
